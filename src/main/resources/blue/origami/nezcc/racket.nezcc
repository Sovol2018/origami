# nezcc file

extension          = rkt

# type

Byte[]->String   = (bytes->string/utf-8 %s)
String->Byte[]   = (string->bytes/utf-8 %s)

Byte[].get       = (string->bytes/utf-8 (substring %1$s %2$s (+ %2$s 1)))
Byte[].quote     = "%s"

Array.size       = (length %s)
Array.get        = (list-ref %s %s)
Array.new        = empty
Array.slice      = (slice %s %s %s)

# syntax

comment          = ; %s
begin            = (
end              = )
;                =

# FIXME classname + %
struct           = (define %s (class object (super-new)
constructor      = (init %2$s)
end constructor  =
init             = (fileld [_%s %s])
#field            = (field [_%s %s])

getter           = (get-field %2$s %1$s)
setter           = (set-field! %2$s %1$s %3$s)

const            = (define %2$s %3$s)

function         = (define (%2$s %3$s)
param            = %2$s
params           = $|space|

and              = (and %s %s)
or               = (or %s %s)
not              = (not %s)

ifexpr           = (if (%1$s) %2$s %3$s)
funccall         = (%s %s)
args             = $|space|
#apply            = %s.apply
#funcref          = $|base|::%s

true             = #t
false            = #f
null             = null

val              = (define %2$s %3$s)
var              = (define %2$s %3$s)
assign           = (set! %s %s)

# TODO white space
array            = (list$|space|
arrays           = $|space|
end array        = )

if               = (if (%s)
switch           = (match %s
case             = [%s %s]
#default          = default : %s

lambda           = (lambda (%s) %s)


def slice = '''
(define get-n-items
    (lambda (lst num)
        (if (> num 0)
            (cons (car lst) (get-n-items (cdr lst) (- num 1)))
            '())))

(define slice
    (lambda (lst start count)
        (if (> start 1)
            (slice (cdr lst) (- start 1) count)
            (get-n-items lst count))))
'''

imports = '''


'''

libs = '''


'''

def newAST = '''
(define newAST (tag inputs pos epos size) (if (= size 0) (list tag (slice inputs pos epos) ) (list tag empty) )
'''

def subAST = '''
(define subAST (parent n label child) )
  ; TODO
  ;parent[1][n] = (label, child)
  ;return parent
'''


main = '''
(define (read_inputs a)
  (define f (open-input-file a))
  ; TODO
  (close-input-port f)
  )

; TODO rec
  (define s (read_inputs a))
  (define st (current-seconds))
  (define t (parse s (- (len s) 1) newAST subAST ))
  (define et (current-seconds))
  ; TODO output

'''

man = '''
=============
 QUICK START
=============

racket $|base|.rkt <file> or <input-text>

Read the main function. You will know how to
integrate the parser into your programs.

'''
